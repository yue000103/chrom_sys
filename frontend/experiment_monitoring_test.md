# 实验监控功能测试指南

## 新增功能说明

### 1. 实验数据持久化
- ✅ 点击"开始实验"时，实验数据会保存到 localStorage
- ✅ 数据保存为 `currentExperiment` 键
- ✅ 实时监控界面可以通过 localStorage 获取实验信息

### 2. 预处理步骤进度显示
- ✅ 自动检测实验是否需要预处理（系统清洗、柱子清洗、柱平衡）
- ✅ 显示步骤进度条和当前步骤详情
- ✅ 实时倒计时显示每个步骤的剩余时间
- ✅ 进度条实时更新显示完成百分比

### 3. 预处理步骤类型
- **系统清洗**: 固定2分钟
- **柱子清洗**: 用户配置的时间（默认5分钟）
- **柱平衡**: 用户配置的时间和溶液类型（默认10分钟，溶液A）

### 4. 控制按钮功能

#### 实验未开始状态 (pending)
- **开始实验**: 检查预处理需求，开始实验或预处理

#### 预处理阶段 (pretreatment)
- **下一步**: 手动跳到下一个预处理步骤
- **暂停**: 暂停当前步骤计时
- **继续**: 恢复步骤计时
- **终止**: 完全停止实验，需要确认
- **实时监控**: 跳转到实时监控界面

#### 正式实验阶段 (running)
- **暂停**: 暂停实验
- **继续**: 恢复实验
- **终止**: 停止实验，需要确认
- **实时监控**: 跳转到实时监控界面

### 5. 状态管理
- **pending**: 实验未开始
- **pretreatment**: 预处理阶段
- **running**: 正式实验进行中
- **paused**: 实验暂停
- **terminated**: 实验终止

### 6. 用户界面特性
- ✅ 响应式设计，支持移动端显示
- ✅ 实时进度条显示步骤完成情况
- ✅ 颜色编码显示不同状态（运行/暂停/警告）
- ✅ 步骤自动完成和手动控制
- ✅ 溶液选择显示（A/B/C/D）

## 测试流程

### 测试用例1: 完整预处理流程
1. 创建一个启用所有预处理步骤的实验：
   - 系统清洗: 是
   - 柱子清洗: 是, 5分钟
   - 柱平衡: 是, 10分钟, 溶液B

2. 选择实验，点击"开始实验"
3. 验证预处理进度显示
4. 测试"下一步"、"暂停"、"继续"、"终止"按钮
5. 让实验自然完成，验证自动跳转

### 测试用例2: 无预处理实验
1. 创建一个无预处理的实验
2. 点击"开始实验"
3. 验证直接跳转到实时监控

### 测试用例3: 数据持久化
1. 开始任意实验
2. 检查 localStorage 中是否保存了 `currentExperiment`
3. 跳转到实时监控界面
4. 验证实时监控界面能够获取实验信息

## 技术实现要点

### 数据流
1. **开始实验** → 保存到 localStorage → 检查预处理需求
2. **预处理阶段** → 步骤计时 → 进度更新 → 自动/手动下一步
3. **完成预处理** → 跳转实时监控
4. **暂停/继续** → 状态管理 → 计时器控制

### 关键方法
- `startExperiment()`: 开始实验，检查预处理
- `calculatePretreatmentSteps()`: 计算预处理步骤数
- `startPretreatmentStep()`: 开始当前步骤计时
- `nextPretreatmentStep()`: 进入下一步
- `pauseExperiment()` / `resumeExperiment()`: 暂停/继续
- `terminateExperiment()`: 终止实验
- `completePretreatment()`: 完成预处理，跳转监控

### 数据结构
```javascript
{
  showPretreatmentProgress: boolean,
  currentPretreatmentStep: number,
  totalPretreatmentSteps: number,
  experimentPaused: boolean,
  remainingStepTime: number,
  stepProgress: number,
  currentStepDuration: number
}
```

## 验证清单
- [ ] 预处理步骤正确计算和显示
- [ ] 计时器准确工作
- [ ] 按钮状态正确切换
- [ ] 数据持久化到 localStorage
- [ ] 自动跳转到实时监控
- [ ] 用户操作反馈（消息提示）
- [ ] 响应式布局正常
- [ ] 溶液选择正确显示